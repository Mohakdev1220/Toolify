<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toolify | Professional PDF Architect</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #0a0a0b; --surface: #141416; --text: #ffffff; --text-dim: #9aa0a6;
            --primary: #00f2ff; --primary-glow: rgba(0, 242, 255, 0.15);
            --border: rgba(255, 255, 255, 0.08); --danger: #ff4d4d; --card-bg: #1c1c1e;
            --glass: rgba(255, 255, 255, 0.03);
        }

        [data-theme="light"] {
            --bg: #f8fafc; --surface: #ffffff; --text: #0f172a; --text-dim: #64748b;
            --primary: #0ea5e9; --primary-glow: rgba(14, 165, 233, 0.1);
            --border: rgba(0, 0, 0, 0.05); --danger: #ef4444; --card-bg: #ffffff;
            --glass: rgba(0, 0, 0, 0.02);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; transition: background 0.2s, transform 0.2s; }
        body { background: var(--bg); color: var(--text); min-height: 100vh; padding-bottom: 120px; overflow-x: hidden; }

        /* Modern Header */
        header {
            position: fixed; top: 0; width: 100%; height: 75px; padding: 0 40px;
            display: flex; justify-content: space-between; align-items: center;
            background: var(--surface); border-bottom: 1px solid var(--border);
            backdrop-filter: blur(15px); z-index: 1000;
        }
        .nav-left { display: flex; align-items: center; gap: 30px; }
        .logo { font-weight: 800; font-size: 1.5rem; letter-spacing: -1.5px; text-decoration: none; color: var(--text); }
        .logo span { color: var(--primary); }
        .back-link { text-decoration: none; color: var(--text-dim); font-size: 0.85rem; display: flex; align-items: center; gap: 8px; font-weight: 500; }
        .back-link:hover { color: var(--primary); }

        .workspace { max-width: 1200px; margin: 110px auto 40px; padding: 0 25px; }

        /* Enhaced Drafts Panel */
        #drafts-panel {
            background: var(--glass); border: 1px solid var(--border);
            border-radius: 24px; padding: 20px; margin-bottom: 30px; display: none;
        }
        .draft-chip {
            display: inline-flex; align-items: center; gap: 10px;
            background: var(--surface); border: 1px solid var(--border);
            padding: 10px 18px; border-radius: 12px; margin: 6px;
            font-size: 0.85rem; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .draft-chip:hover { border-color: var(--primary); transform: translateY(-2px); }

        /* Minimalist Upload Zone */
        .drop-zone {
            border: 2px dashed var(--border); border-radius: 32px;
            padding: 100px 20px; text-align: center; cursor: pointer;
            background: var(--surface); transition: 0.4s;
        }
        .drop-zone:hover { border-color: var(--primary); background: var(--primary-glow); }

        /* Dynamic Toolbar */
        .toolbar {
            display: none; justify-content: space-between; align-items: center;
            background: var(--surface); padding: 20px 30px; border-radius: 24px;
            margin-bottom: 35px; border: 1px solid var(--border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .pdf-input {
            background: var(--bg); border: 1px solid var(--border);
            color: var(--text); padding: 12px 20px; border-radius: 12px; outline: none; width: 350px; font-weight: 500;
        }

        /* Image Grid */
        #image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 30px; }
        .img-card {
            background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 24px; padding: 15px; position: relative; cursor: grab;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .img-card:hover { border-color: var(--primary); }
        .img-card img { width: 100%; height: 180px; object-fit: contain; border-radius: 16px; background: #000; pointer-events: none; }

        /* Filter & Button Styling */
        .btn { padding: 12px 28px; border-radius: 14px; border: none; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        
        /* Modal & Editor */
        #crop-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); z-index: 2000; padding: 40px;
        }
        .editor-container { display: flex; gap: 30px; height: 75vh; max-width: 1200px; margin: 0 auto; }
        .filter-panel { width: 300px; background: var(--surface); border-radius: 20px; padding: 25px; border: 1px solid var(--border); }
        .filter-group { margin-bottom: 25px; }
        .filter-group label { display: block; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 10px; }
        input[type="range"] { width: 100%; accent-color: var(--primary); }

        footer {
            position: fixed; bottom: 0; width: 100%; padding: 25px;
            text-align: center; font-size: 0.85rem; color: var(--text-dim);
            background: var(--surface); border-top: 1px solid var(--border); z-index: 1001;
        }
        .heart { color: #ff3333; }

        .floating-bar {
            position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%);
            background: var(--surface); border: 1px solid var(--primary);
            padding: 15px 40px; border-radius: 100px; display: none;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6); z-index: 999; gap: 25px;
        }
    </style>
</head>
<body data-theme="dark">

    <header>
        <div class="nav-left">
            <a href="index.html" class="logo">Tool<span>ify</span></a>
            <a href="index.html" class="back-link">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                Back to Tools Hub
            </a>
        </div>
        <div style="display:flex; gap:15px;">
            <button class="btn btn-outline" onclick="handleCreateNew()">+ New PDF</button>
            <button class="btn btn-outline" style="width:48px; padding:0; justify-content:center;" onclick="toggleTheme()">üåì</button>
        </div>
    </header>

    <main class="workspace">
        <div id="drafts-panel">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <p style="font-size:0.75rem; font-weight:800; color:var(--text-dim); text-transform:uppercase;">Draft Archives</p>
                <button onclick="clearAllDrafts()" style="background:none; border:none; color:var(--danger); cursor:pointer; font-size:0.75rem;">Clear All</button>
            </div>
            <div id="drafts-container"></div>
        </div>

        <div class="drop-zone" id="drop-zone">
            <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="1.5" style="margin-bottom:20px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
            <h2 style="margin-bottom: 10px;">PDF Architect Pro</h2>
            <p style="color: var(--text-dim);">Import images to generate high-resolution PDF documents</p>
            <input type="file" id="file-input" multiple accept="image/*" hidden onchange="processFiles(this.files)">
        </div>

        <div class="toolbar" id="main-toolbar">
            <input type="text" id="pdf-name" class="pdf-input" placeholder="Project Name (e.g., Marketing_Flyer)">
            <div style="display:flex; gap:25px; align-items: center;">
                <label style="font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="select-all" onclick="toggleSelectAll()" style="width:18px; height:18px;"> Select All
                </label>
                <button onclick="deleteSelected()" style="color: var(--danger); font-weight: 700; background:none; border:none; cursor:pointer;">Delete</button>
            </div>
        </div>

        <div id="image-grid"></div>
    </main>

    <div class="floating-bar" id="float-bar">
        <button class="btn btn-outline" onclick="document.getElementById('file-input').click()">+ Add Images</button>
        <button class="btn btn-primary" onclick="generatePDF()">Download PDF</button>
    </div>

    <footer>DEVELOPED WITH <span class="heart">‚ù§</span> BY MOHAK</footer>

    <div id="crop-modal">
        <div class="editor-container">
            <div style="flex:1; background:#000; border-radius:20px; overflow:hidden;">
                <img id="crop-img" style="max-width:100%;">
            </div>
            <div class="filter-panel">
                <h3 style="margin-bottom:20px; font-size:1.1rem;">Enhancements</h3>
                
                <div class="filter-group">
                    <button class="btn btn-outline" style="width:100%; font-size:0.8rem;" onclick="applyPreset('grayscale')">üìÑ Grayscale (Document Mode)</button>
                </div>

                <div class="filter-group">
                    <label>Brightness</label>
                    <input type="range" id="bright-range" min="0" max="200" value="100" oninput="applyFilters()">
                </div>

                <div class="filter-group">
                    <label>Contrast</label>
                    <input type="range" id="contrast-range" min="0" max="200" value="100" oninput="applyFilters()">
                </div>

                <div style="margin-top:40px; display:flex; flex-direction:column; gap:10px;">
                    <button class="btn btn-primary" style="width:100%; justify-content:center;" onclick="saveEditorChanges()">Save Changes</button>
                    <button class="btn btn-outline" style="width:100%; justify-content:center; color:white;" onclick="closeCrop()">Cancel</button>
                    <button class="btn-ghost" style="margin-top:10px; color:var(--text-dim); font-size:0.7rem; background:none; border:none; cursor:pointer;" onclick="resetFilters()">Reset All Filters</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentImages = [];
        let sortable = null;
        let activeIndex = null;
        let cropper = null;

        window.onload = () => {
            renderDrafts();
            const saved = localStorage.getItem('toolify_session_v4');
            if (saved) {
                currentImages = JSON.parse(saved);
                document.getElementById('pdf-name').value = localStorage.getItem('toolify_name_v4') || "";
                updateUI();
            }
        };

        const dz = document.getElementById('drop-zone');
        dz.onclick = () => document.getElementById('file-input').click();
        dz.ondragover = (e) => { e.preventDefault(); dz.style.borderColor = "var(--primary)"; };
        dz.ondrop = (e) => { e.preventDefault(); processFiles(e.dataTransfer.files); };

        function processFiles(files) {
            Array.from(files).forEach(file => {
                if(!file.type.startsWith('image/')) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    currentImages.push({ 
                        id: Math.random().toString(36).substr(2, 9), 
                        src: e.target.result, 
                        selected: false,
                        filters: { brightness: 100, contrast: 100, grayscale: 0 }
                    });
                    updateUI();
                };
                reader.readAsDataURL(file);
            });
        }

        function updateUI() {
            const hasImages = currentImages.length > 0;
            dz.style.display = hasImages ? 'none' : 'block';
            document.getElementById('main-toolbar').style.display = hasImages ? 'flex' : 'none';
            document.getElementById('float-bar').style.display = hasImages ? 'flex' : 'none';

            const grid = document.getElementById('image-grid');
            grid.innerHTML = '';

            currentImages.forEach((img, idx) => {
                const card = document.createElement('div');
                card.className = 'img-card';
                card.setAttribute('data-id', img.id);
                card.innerHTML = `
                    <input type="checkbox" style="position:absolute; top:18px; left:18px; z-index:10;" ${img.selected ? 'checked' : ''} onchange="toggleCheck(${idx})">
                    <img src="${img.src}" style="filter: brightness(${img.filters.brightness}%) contrast(${img.filters.contrast}%) grayscale(${img.filters.grayscale}%)">
                    <button class="btn btn-outline" style="width:100%; margin-top:12px; font-size:0.7rem; justify-content:center;" onclick="openEditor(${idx})">Edit & Filter</button>
                `;
                grid.appendChild(card);
            });

            if (sortable) sortable.destroy();
            sortable = new Sortable(grid, { 
                animation: 250, 
                onEnd: () => {
                    const newOrder = [];
                    document.querySelectorAll('.img-card').forEach(el => {
                        newOrder.push(currentImages.find(i => i.id === el.getAttribute('data-id')));
                    });
                    currentImages = newOrder;
                    saveSession();
                }
            });
            saveSession();
        }

        // Editor Functions
        function openEditor(idx) {
            activeIndex = idx;
            const img = currentImages[idx];
            document.getElementById('crop-img').src = img.src;
            document.getElementById('bright-range').value = img.filters.brightness;
            document.getElementById('contrast-range').value = img.filters.contrast;
            
            document.getElementById('crop-modal').style.display = 'block';
            if (cropper) cropper.destroy();
            cropper = new Cropper(document.getElementById('crop-img'), { viewMode: 1 });
            applyFilters();
        }

        function applyFilters() {
            const b = document.getElementById('bright-range').value;
            const c = document.getElementById('contrast-range').value;
            const cropperImg = document.querySelector('.cropper-view-box img');
            if(cropperImg) {
                cropperImg.style.filter = `brightness(${b}%) contrast(${c}%) grayscale(${currentImages[activeIndex].filters.grayscale}%)`;
            }
        }

        function applyPreset(type) {
            if(type === 'grayscale') {
                currentImages[activeIndex].filters.grayscale = currentImages[activeIndex].filters.grayscale === 100 ? 0 : 100;
                applyFilters();
            }
        }

        function saveEditorChanges() {
            const b = document.getElementById('bright-range').value;
            const c = document.getElementById('contrast-range').value;
            
            // Render the final filtered + cropped version to a permanent dataURL
            const canvas = cropper.getCroppedCanvas();
            const ctx = canvas.getContext('2d');
            
            // Draw filters onto canvas
            ctx.filter = `brightness(${b}%) contrast(${c}%) grayscale(${currentImages[activeIndex].filters.grayscale}%)`;
            ctx.drawImage(canvas, 0, 0);

            currentImages[activeIndex].src = canvas.toDataURL('image/jpeg', 0.95);
            currentImages[activeIndex].filters = { brightness: 100, contrast: 100, grayscale: 0 }; // Reset filters since they are "baked in"
            
            closeCrop();
            updateUI();
        }

        function resetFilters() {
            document.getElementById('bright-range').value = 100;
            document.getElementById('contrast-range').value = 100;
            currentImages[activeIndex].filters.grayscale = 0;
            applyFilters();
        }

        // Project Management
        function handleCreateNew() {
            if (currentImages.length > 0 && confirm("Save current project to Drafts and start new?")) {
                const drafts = JSON.parse(localStorage.getItem('toolify_drafts_v4') || '[]');
                drafts.push({ name: (document.getElementById('pdf-name').value || "Draft") + " (" + new Date().toLocaleDateString() + ")", data: currentImages });
                localStorage.setItem('toolify_drafts_v4', JSON.stringify(drafts));
                currentImages = [];
                updateUI();
                renderDrafts();
            }
        }

        function renderDrafts() {
            const drafts = JSON.parse(localStorage.getItem('toolify_drafts_v4') || '[]');
            const container = document.getElementById('drafts-container');
            document.getElementById('drafts-panel').style.display = drafts.length ? 'block' : 'none';
            container.innerHTML = drafts.map((d, i) => `<div class="draft-chip" onclick="loadDraft(${i})">üìÑ ${d.name}</div>`).join('');
        }

        function loadDraft(i) {
            const drafts = JSON.parse(localStorage.getItem('toolify_drafts_v4') || '[]');
            currentImages = drafts[i].data;
            updateUI();
        }

        function clearAllDrafts() { if(confirm("Clear all archived drafts?")) { localStorage.removeItem('toolify_drafts_v4'); renderDrafts(); } }
        function closeCrop() { document.getElementById('crop-modal').style.display = 'none'; }
        function toggleCheck(idx) { currentImages[idx].selected = !currentImages[idx].selected; }
        function toggleSelectAll() { const s = document.getElementById('select-all').checked; currentImages.forEach(i => i.selected = s); updateUI(); }
        function deleteSelected() { currentImages = currentImages.filter(i => !i.selected); updateUI(); }
        function toggleTheme() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'); }
        function saveSession() { localStorage.setItem('toolify_session_v4', JSON.stringify(currentImages)); localStorage.setItem('toolify_name_v4', document.getElementById('pdf-name').value); }

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            currentImages.forEach((img, i) => {
                if (i > 0) doc.addPage();
                doc.addImage(img.src, 'JPEG', 0, 0, 210, 297, undefined, 'FAST');
            });
            doc.save(`${document.getElementById('pdf-name').value || 'toolify'}.pdf`);
        }
    </script>
</body>
</html>
